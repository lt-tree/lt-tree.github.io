<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tree House</title>
  
  <subtitle>不如自挂东南枝</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2021-10-31T06:24:13.400Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>ltree98</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>《乡土中国》读记</title>
    <link href="http://yoursite.com/2021/10/31/%E3%80%8A%E4%B9%A1%E5%9C%9F%E4%B8%AD%E5%9B%BD%E3%80%8B%E8%AF%BB%E8%AE%B0/"/>
    <id>http://yoursite.com/2021/10/31/%E3%80%8A%E4%B9%A1%E5%9C%9F%E4%B8%AD%E5%9B%BD%E3%80%8B%E8%AF%BB%E8%AE%B0/</id>
    <published>2021-10-31T06:20:00.000Z</published>
    <updated>2021-10-31T06:24:13.400Z</updated>
    
    <content type="html"><![CDATA[<p>id 就是兽性</p><p>ego 是个两面派，即一面要克己复礼的作个社会所能接受的人，一面是又是满身难受地想越狱当逃犯</p><p>super-ego 就是顶在头上，不得不服从的社会规定的身份</p><a id="more"></a><p><br></p><h1 id="读因"><a href="#读因" class="headerlink" title="读因"></a>读因</h1><p>为什么想要读《乡土社会》这本书呢？</p><p>我个人对于故乡的概念不是很重，可能是因为从小搬家比较多相关吧，所以不是很理解，父母辈那种老了，就想回到老家生活的感觉。</p><p>如果说我是一个个例，但随着时代发展，越来越多的年轻人也对回老家，有些抵触或是形式化。</p><p>所以，想了解一下，这份乡土，这份社会，还有这份变迁。</p><p>这本书，真的值得细细品味，等待五年后，再来复读。</p><p><br></p><p><br></p><h1 id="读感"><a href="#读感" class="headerlink" title="读感"></a>读感</h1><p>乡土社会的本色与土相关，人类的生存所需都从土里索求，因此，人的品性，社会的基因，也大多有土的影子；但随着时代发展，生存所需的不仅仅由土提供，所以品行、社会的基因，也在不断的变革。</p><p>对于古早的乡土社会，大家的交流都是面对面的，都是务实且闭塞的，因此，形成了弱文化、差序格局与男女有别的状况；感触最深的就是差序格局；西洋的格局像是一捆捆扎清楚的柴，但我们的格局，是一块石头扔进塘中激起的那一轮轮涟漪。</p><p>随着时代发展，有个大的变化，是由传统礼治社会到法治社会的转变。其中，并没有绝对的对错，根据不同的现状，采取不同的措施，得到最大的效益，才是最终的目的。我更赞同的一点是，这是一个变化的过程，包括法治，可能也不是最终的终点，整个依旧在变化，根据遇到的问题，不断优化，优化的方向可能也有“回头”的状况，但是表象上的一致并不代表内因的一致。</p><p>是什么导致乡土社会的改变呢？</p><p>外因于交流，内因于人性。</p><p>人性在于，它有各种欲望，它需要被满足；满足了必要欲望后，不同的人有了不同非必要欲望。</p><p>交流在于，它提供了更多的途径，更多的方式；有了不同的选择。</p><p>时代的发展，让交流更充分；而交流又激发更多的欲望。</p><p><br></p><p><br></p><h1 id="片段"><a href="#片段" class="headerlink" title="片段"></a>片段</h1><h2 id="乡土本色"><a href="#乡土本色" class="headerlink" title="乡土本色"></a>乡土本色</h2><p>从土里长出过光荣的历史，自然也会受到土的束缚，现在很有些飞不上天的样子。</p><p>这是乡土社会的特性之一。我们很可以相信，以农为生的人，世代定居是常态，迁移是变态。大旱大水，连年兵乱，可以使一部分农民抛井离乡；即使像抗战这样大事件所引起基层人口的流动，我相信还是微乎其微的。</p><p>并不是说中国乡村人口是固定的。这是不可能的，因为人口在增加，一块地上只要几代的繁殖，人口就到了饱和点；过剩的人口自得宣泄出外，负起锄头去另辟新地。可是老根是不常动的。这些宣泄出外的人，像是从老树上被风吹出去的种子，找到土地的生存了，又形成一个小小的家族殖民地，找不到土地的也就在各式各样的运命下被淘汰了，或是“发迹了”。</p><p>乡土社会的信用并不是对契约的重视，而是发生于对一种行为的规矩熟悉到不加思索时的可靠性。</p><h2 id="文字下乡"><a href="#文字下乡" class="headerlink" title="文字下乡"></a>文字下乡</h2><p>“特殊语言”不过是亲密社群中所使用的象征体系的一部分，用声音来作象征的那一部分。在亲密社群中可用来作象征体系的原料比较多。表情、动作，在面对面的情景中，有时比声音更容易传情达意。</p><p>语言像是个社会定下的筛子，如果我们有一种情谊和这筛子的格子不同也就漏不过去。我想大家必然有过“无言胜似有言”的经验。其实这个筛子虽则有助于人和人间的了解，但同时却也使人和人间的情谊公式化了，使每一人、每一刻的实际情谊都走了一点样。我们永远在削足适履，使感觉敏锐的人怨恨语言的束缚。</p><h2 id="再论文字下乡"><a href="#再论文字下乡" class="headerlink" title="再论文字下乡"></a>再论文字下乡</h2><p>所谓学就是在出生之后以一套人为的行为方式作模型，把本能的那一套方式加以改造的过程。学的方法是“习”。习是指反复地做，靠时间中的磨练，使一个人惯于一种新的做法。</p><p>文化是依赖象征体系和个人的记忆而维护着的社会共同经验。这样说来，每个人的“当前”，不但包括他个人“过去”的投影，而且还是整个民族的“过去”的投影。历史对于个人并不是点缀的饰物，而是实用的、不可或缺的生活基础。人不能离开社会生活，就不能不学习文化。文化得靠记忆，不能靠本能，所以人在记忆力上不能不力求发展。</p><h2 id="差序格局"><a href="#差序格局" class="headerlink" title="差序格局"></a>差序格局</h2><p>为什么我们这个最基本的社会单位的名词会这样不清楚呢？在我看来却表示了我们的社会结构本身和西洋的格局是不相同的，我们的格局不是一捆一捆扎清楚的柴，而是好像把一块石头丢在水面上所发生的一圈圈推出去的波纹。每个人都是他社会影响所推出去的圈子的中心。被圈子的波纹所推及的就发生联系。每个人在某一时间某一地点所动用的圈子是不一定相同的</p><h2 id="维系着私人的道德"><a href="#维系着私人的道德" class="headerlink" title="维系着私人的道德"></a>维系着私人的道德</h2><p>这在差序社会里可以不觉得是矛盾；因为在这种社会中，一切普遍的标准并不发生作用，一定要问清了，对象是谁，和自己什么关系之后，才能决定拿出什么标准来。</p><h2 id="男女有别"><a href="#男女有别" class="headerlink" title="男女有别"></a>男女有别</h2><p>Oswald Spengler在“西方陆沈论”里曾说西洋曾有两种文化模式：一种他称作阿波罗式的Apollonian；一种他称作浮士德式的Faustian。阿波罗式的文化认定宇宙的安排有一个完善的秩序，这个秩序超于人力的创造，人不过是去接受它，安于其位，维持它；但是人连维持它的力量都没有，天堂遗失了，黄金时代过去了。这是西方古典的精神。现代的文化却是浮士德式的。他们把冲突看成存在的基础，生命是阻碍的克服；没有了阻碍，生命也就失去了意义。他们把前途看成无尽的创造过程，不断改变。</p><p>社会秩序范围着个性，为了秩序的维持，一切足以引起破坏秩序的要素都被遏制着。男女之间的鸿沟从此驻下。乡土社会是个男女有别的社会，也是个安稳的社会。</p><h2 id="礼治秩序"><a href="#礼治秩序" class="headerlink" title="礼治秩序"></a>礼治秩序</h2><p>礼是社会公认合式的行为规范。合于礼的就是说这些行为是做的对的，对是合式的意思。如果单从行为规范一点说，本和法律无异，法律也是一种行为规范。礼和法不相同的地方是维持规范的力量。法律是靠国家的权力来推行的。“国家”是指政治的权力，在现代国家没有形成前，部落也是政治权力。而礼却不需要这有形的权力机构来维持。维持礼这种规范的是传统。</p><p>礼治的可能必须以传统可以有效地应付生活问题为前提。乡土社会满足了这前提，因之它的秩序可以用礼来维持。在一个变迁很快的社会，传统的效力是无法保证的。</p><p>法治和礼治是发生在两种不同的社会情态中。这里所谓礼治也许就是普通所谓人治，但是礼治一词不会像人治一词那样容易引起误解，以致有人觉得社会秩序是可以由个人好恶来维持的了。礼治和这种个人好恶的统治相差甚远，因为礼是传统，是整个社会历史在维持这种秩序。礼治社会是并不能在变迁很快的时代中出现的，这是乡土社会的特色。</p><h2 id="无讼"><a href="#无讼" class="headerlink" title="无讼"></a>无讼</h2><p>现行的司法制度在乡间发生了很特殊的副作用，它破坏了原有的礼治秩序，但并不能有效地建立起法治秩序。法治秩序的建立不能单靠制定若干法律条文和设立若干法庭，重要的还得看人民怎样去应用这些设备。更进一步，在社会结构和思想观念上还得先有一番改革。如果在这些方面不加以改革，单把法律和法庭推行下乡，结果法治秩序的好处未得，而破坏礼治秩序的弊病却已先发生了。</p><h2 id="无为政治"><a href="#无为政治" class="headerlink" title="无为政治"></a>无为政治</h2><p>同意权力却有着一套经济条件的限制。依我在上面所说的，同意权力是分工体系的产物。分工体系发达，这种权力才能跟着扩大。乡土社会是个小农经济，在经济上每个农家，除了盐铁之外，必要时很可关门自给。于是我们很可以想象同意权力的范围也可以小到“关门”的程度。</p><h2 id="血缘和地缘"><a href="#血缘和地缘" class="headerlink" title="血缘和地缘"></a>血缘和地缘</h2><p>缺乏变动的文化里，长幼之间发生了社会的差次，年长的对年幼的具有强制的权力。这是血缘社会的基础。血缘的意思是人和人的权利和义务根据亲属关系来决定。亲属是由生育和婚姻所构成的关系。</p><p>地缘是从商业里发展出来的社会关系。血缘是身份社会的基础，而地缘却是契约社会的基础。</p><h2 id="名实的分离"><a href="#名实的分离" class="headerlink" title="名实的分离"></a>名实的分离</h2><p>在新旧交替之际，不免有一个惶惑、无所适从的时期，在这个时期，心理上充满着紧张、犹豫和不安。这里发生了“文化英雄”，他提得出办法，有能力组织新的试验，能获得别人的信任。这种人可以支配跟从他的群众，发生了一种权力。这种权力和横暴权力并不相同，因为它并不是建立在剥削关系之上的；和同意权力又不同，因为它并不是由社会所授权的；和长老权力更不同，因为它并不根据传统的。它是时势所造成的，无以名之，名之曰时势权力。</p><p>儒家所注重的“孝”道，其实是维持社会安定的手段，孝的解释是“无违”，那就是承人长老权力。长老代表传统，遵守传统也就可以无违于父之教。但是传统的代表是要死亡的，而且自己在时间过程中也会进入长老的地位。如果社会变迁的速率慢到可以和世代交替的速率相等，亲子之间，或是两代之间，不致发生冲突，传统自身慢慢变，还是可以保持长老的领导权。这种社会也就不需要“革命”了。</p><p>从整个社会看，一个领导的阶层如果能追得上社会变迁的速率，这社会也可以避免因社会变迁而发生的混乱。</p><h2 id="从欲望到需要"><a href="#从欲望到需要" class="headerlink" title="从欲望到需要"></a>从欲望到需要</h2><p>在乡土社会中人可以靠欲望去行事，但在现代社会中欲望并不能作为人们行为的指导，于是产生了“需要”，因之有了“计划”。</p><p>说人类行为是有动机的包含着两个意思：一是人类对于自己的行为是可以控制的。要这样做就这样做，不要这样做就不这样做，也就是所谓的意志。一是人类在取舍之间有所根据，这根据就是欲望。</p><p>爱情，好吃，是欲望，那是自觉的。直接决定我们行为的确是这些欲望。这些欲望所引导出来的行为是不是总和人类生存的条件相合的呢？这问题曾引起过很多学者的讨究。我们如果从上面这段话看去，不免觉得人类的欲望确乎有点微妙，他们尽管要这个要那个，结果却常常正合于他们生存的条件。</p><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>对“社会”历来有两种基本上不同的看法。一是把社会看作众多个人集合生活的群体。严复翻译sociology作“群学”。众人为群，一个个人为了生活的需要而聚集在一起形成群体，通过分工合作来经营共同生活，满足个人的生活需要。另一种看法却认为群体固然是由一个个人聚合而成，没有一个个人也就没有群体，这是简单易明的。但是形成了群体的个人，已经不仅是一个个生物体，他们已超出了自然演化中的生物界，进入了另一个层次，这个层次就是社会界。</p><p>生物实体和社会实体是属于自然演化过程中的两个层次。人有两个属性：生物人和社会人。</p><p>社会就是人类的群体。更符合我的主观倾向的是社会所规定的一切成规和制度都是人造出来，满足人的生活需要的手段，如果不能满足就得改造，手段自应服从人的主观要求。中国人民在我这一生中正处在社会巨大变动之世。如果社会制度不是人类的手段，那就好像谈不上人为的改革了。</p><p>我想只有从每个社区根据它特有的具体条件而形成的社会结构出发，不同社区才能相互比较。在互相比较中才能看出同类社区的差别，而从各社区具体条件去找出差别的原因，进一步才能看到社区发展和变动的规律，进入理论的领域。</p><p>我越来越觉得一个人的思想总是离不开他本人的切身经历。我从解放后所逢到的我称之为不寻常的经历，必然会反映在我其后的学术思想上，以至于立身处世的现实生活上。我如果完全把这段时间作为学术经历中的空白是不够认真的。</p><p>埃尔顿·梅岳教授，曾在芝加哥的霍桑工厂里研究怎样提高劳动生产率的问题，做了一系列实验。起初他采取改变各种工作条件，如厂内的光线，休息的时间等，来测验工作效率是否有相应的提高，结果确实上升了。但梅岳认为并没有解决提高工作效率的关键问题。他接着再做实验倒过来一一取消了这些客观条件的改变，出乎大家意料之外，工作效率却依然上升。他从中得到一个重大发现，原来不是客观条件的改变促使了工作效率的上升，而是他的实验本身起了作用。因为工人参与了这个实验，自己觉得在进行一项有意义的科学工作，从而发现了自己不仅是一个普通拿工资干活的机器，而是一个能创造科学价值的实验者了。这个转变提高了他们的积极性。梅岳在这里发现了普通“工人身份”后面潜伏着一种“人的因素”，这个因素是工作效率的泉源。</p><p>所以我用了Freud所说的三层结构来说明人的心里构成：一是id（生物性的冲动），二是ego（自己），三是super-ego（超己）。id就是兽性，ego是个两面派，即一面要克己复礼的作个社会所能接受的人，一面是又是满身难受地想越狱当逃犯。super-ego就是顶在头上，不得不服从的社会规定的身份。</p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;id 就是兽性&lt;/p&gt;
&lt;p&gt;ego 是个两面派，即一面要克己复礼的作个社会所能接受的人，一面是又是满身难受地想越狱当逃犯&lt;/p&gt;
&lt;p&gt;super-ego 就是顶在头上，不得不服从的社会规定的身份&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="看着读" scheme="http://yoursite.com/tags/%E7%9C%8B%E7%9D%80%E8%AF%BB/"/>
    
  </entry>
  
  <entry>
    <title>SVN之Hook</title>
    <link href="http://yoursite.com/2021/10/30/SVN%E4%B9%8BHook/"/>
    <id>http://yoursite.com/2021/10/30/SVN%E4%B9%8BHook/</id>
    <published>2021-10-30T15:11:16.000Z</published>
    <updated>2021-10-30T15:34:35.651Z</updated>
    
    <content type="html"><![CDATA[<p>SVN之Hook</p><a id="more"></a><p><br></p><h1 id="SVN"><a href="#SVN" class="headerlink" title="SVN"></a>SVN</h1><p>此处主要以 TortoiseSVN为例</p><h2 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h2><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><p>client side hook - 客户端侧hook<br>server side hook - 服务器侧hook</p><h3 id="Client-Side-Hook"><a href="#Client-Side-Hook" class="headerlink" title="Client Side Hook"></a>Client Side Hook</h3><p>类型：</p><ul><li>Start-commit, 在提交对话框展示前调用。</li><li>Manual Pre-commit, 在提交对话框会显示 Run Hook 按钮，用来手动选择是否执行hook</li><li>Check-commit, 在提交对话框关闭前调用（点击 提交对话框的 OK 按钮，关闭对话框前）</li><li>Pre-commit, 在提交行为开始前调用（点击 提交对话框 OK 按钮，但提交行为开始前）</li><li>Post-commit, 提交行为结束后调用（无论成功与否）</li><li>Start-update, 在更新弹窗展示前调用</li><li>Pre-update, 在更新行为开始前调用</li><li>Post-update, 在更新行为结束后调用</li><li>Pre-connect, 在关联存储库之前调用</li></ul><p>如果想为指定的工作路径添加钩子，只需要指定顶级路径，如果在子文件夹进行操作，SVN会自动向上搜索匹配的路径。<br>接下来必须指定执行命令行，先写可执行的hook脚本路径。脚本可以是批处理文件、可执行文件或其他合法关联windows文件的文件。<br>命令行包含几个由TortoiseSVN填充的参数，传递的参数取决于调用的钩子，每个钩子都有自己的参数。</p><p>类型对应的参数：</p><ul><li>Start-commit, [ PATH MESSAGEFILE CWD ]</li><li>Manual Pre-commit, [ PATH MESSAGEFILE CWD ]</li><li>Check-commit, [ PATH MESSAGEFILE CWD ]</li><li>Pre-commit, [ PATH DEPTH MESSAGEFILE CWD ]</li><li>Post-commit, [ PATH DEPTH MESSAGEFILE REVISION ERROR CWD ]</li><li>Start-update, [ PATH CWD ]</li><li>Pre-update, [ PATH DEPTH REVISION CWD ]</li><li>Post-update, [ PATH DEPTH REVISION ERROR CWD RESULTPATH ]</li><li>Pre-connect, 没有参数传递给该脚本，可以通过将自定义参数附加到脚本路径中来传递自定义参数</li></ul><p>各个参数含义：</p><ul><li>PATH<ul><li>执行操作的路径；如果是远程操作，则是受影响项目的url</li></ul></li><li>MESSAGEFILE<ul><li>包含提交信息日志文件的路径，文件内为UTF-8编码的文本，执行start-commit钩子后，会读回日志消息，让钩子有机会修改它。</li></ul></li><li>CWD<ul><li>运行脚本的工作目录</li></ul></li><li>DEPTH<ul><li>提交/更新行为的深度</li><li>枚举值<ul><li>-2, svn_depth_unknown</li><li>-1, svn_depth_exclude</li><li>0, svn_depth_empty</li><li>1, svn_depth_files</li><li>2, svn_depth_immediates</li><li>3, svn_depth_infinity</li></ul></li></ul></li><li>REVISION<ul><li>提交/更新完成后的存储库修订版本</li></ul></li><li>ERROR<ul><li>包含错误消息文件的路径，没有错误时，文件将为空</li></ul></li><li>RESULTPATH<ul><li>临时文件的路径，包含操作及某种方式操作的所有路径，每个路径都在单独的一行</li></ul></li></ul><h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>问题：<br>项目开发过程中，策划上传表后，格式填写错误，比如[]不匹配等，会导致转lua失败，从而进不去游戏；一人的疏忽错误影响整个主线程阻塞。</p><p>方案：<br>在策划上传表之前，先执行转换lua脚本，若执行失败，则禁止上传表</p><p>流程:</p><ol><li>编辑hook脚本，此处放在流程 pre-commit处<ul><li>脚本流程是执行转lua脚本，执行完毕后，收集错误信息，若存在错误，则异常退出（上传表失败），在commit dialog显示错误信息，若无错误，则正常退出（上传表成功）。</li></ul></li><li>调整转lua脚本<ul><li>收集错误信息，输出到指定文件中</li><li>执行失败时，抛出错误代码，方便hook脚本收集</li></ul></li><li>配置hook脚本<ul><li>此处配置的时候，处理脚本，还要指定参数-脚本文件路径</li><li>右键任意文件夹, TortoiseSVN - setting - Hook Scripts - Add - 填写脚本全路径 SVN根目录（方便使用相对目录定位各个目录）</li><li>通过 1&gt;&amp;2，输出到 commit dialog 窗口</li></ul></li><li>使用</li></ol><p>问题：</p><ul><li>需要策划自行配置，自缚双手</li><li>目前是全量进行所有表的转换，虽然有缓存，但依旧要等待很久，最优解是只转换要上传的表；但要解析提交者、提交内容，需要用到 svnlook，该命令需要在 server side hook 中使用（需要服务器权限）。</li><li>由于是借助TortiseSVN，通过命令行提交可以绕过该hook</li></ul><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="comment">REM Get input param</span></span><br><span class="line"></span><br><span class="line"><span class="comment">REM svn root path like D:\work\SG\s, it will include folder svn, folder design</span></span><br><span class="line"><span class="built_in">set</span> TSVN_ROOT_PATH=%<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> TSVN_PATH=%<span class="number">2</span></span><br><span class="line"><span class="built_in">set</span> TSVN_DEPTH=%<span class="number">3</span></span><br><span class="line"><span class="built_in">set</span> TSVN_MESSAGEFILE=%<span class="number">4</span></span><br><span class="line"><span class="built_in">set</span> TSVN_CWD=%<span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">REM lua脚本错误日志文件</span></span><br><span class="line"><span class="built_in">set</span> TSVN_TEMP_FILE=<span class="variable">%TSVN_ROOT_PATH%</span>\svn\svn_hook\temp_output.txt</span><br><span class="line"><span class="comment">REM lua脚本所在目录</span></span><br><span class="line"><span class="built_in">set</span> TSVN_DESIGN_PATH=<span class="variable">%TSVN_ROOT_PATH%</span>\design\</span><br><span class="line"><span class="comment">REM lua脚本</span></span><br><span class="line"><span class="built_in">set</span> TSVN_CHECK_LUA_SCRIPT=csvToClient1.<span class="number">0</span>_forsvnhook.py</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /d <span class="variable">%TSVN_DESIGN_PATH%</span></span><br><span class="line">python <span class="variable">%TSVN_CHECK_LUA_SCRIPT%</span> &gt; <span class="variable">%TSVN_TEMP_FILE%</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="variable">%errorlevel%</span> <span class="keyword">gtr</span> <span class="number">0</span> <span class="keyword">goto</span> err</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%errorlevel%</span>! <span class="number">1</span>&gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="built_in">echo</span> Success! <span class="number">1</span>&gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="keyword">exit</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">:err</span><br><span class="line"><span class="built_in">echo</span> Please check your csv. Commit aborted! <span class="number">1</span>&gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%errorlevel%</span>! <span class="number">1</span>&gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="built_in">echo</span> error message:  <span class="number">1</span>&gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> /f "delims=" <span class="variable">%%x</span> <span class="keyword">in</span> (<span class="variable">%TSVN_TEMP_FILE%</span>) <span class="keyword">do</span> (<span class="built_in">echo</span> <span class="variable">%%x</span> <span class="number">1</span>&gt;&amp;<span class="number">2</span>)</span><br><span class="line"><span class="keyword">exit</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>具体配置流程：</p><p><img src="流程_1.png" alt=""></p><p><img src="流程_2.png" alt=""></p><p><img src="流程_3.png" alt=""></p><p><img src="流程_4.png" alt=""></p><p><img src="流程_5.png" alt=""></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;SVN之Hook&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="想就做" scheme="http://yoursite.com/tags/%E6%83%B3%E5%B0%B1%E5%81%9A/"/>
    
  </entry>
  
  <entry>
    <title>Cocos2d 之 控制台</title>
    <link href="http://yoursite.com/2021/10/29/Cocos2d%20%E4%B9%8B%20%E6%8E%A7%E5%88%B6%E5%8F%B0/"/>
    <id>http://yoursite.com/2021/10/29/Cocos2d%20%E4%B9%8B%20%E6%8E%A7%E5%88%B6%E5%8F%B0/</id>
    <published>2021-10-29T15:15:16.000Z</published>
    <updated>2021-10-30T14:37:14.203Z</updated>
    
    <content type="html"><![CDATA[<p>Cocos2d 之 控制台</p><a id="more"></a><p><br></p><h1 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h1><p>游戏全球化版本开发过程中，需要在控制台显示各种国家语言，而不是一堆乱码或？。</p><p><br><br><br></p><h1 id="探寻"><a href="#探寻" class="headerlink" title="探寻"></a>探寻</h1><h2 id="字符集-amp-代码页"><a href="#字符集-amp-代码页" class="headerlink" title="字符集 &amp; 代码页"></a>字符集 &amp; 代码页</h2><p>关于字符集与字符编码可跳转文章 - <a href="http://www.lt-tree.com/2021/10/26/%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8E%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" target="_blank" rel="noopener">字符集与字符编码</a></p><p>MultiByteToWideChar 和 WideCharToMultiByte 是用于在 ANSI 和 Unicode 之间转换字符的 Unicode 和字符集函数。 这些函数可能会导致安全风险，因为它们以不同的方式对输入和输出缓冲区的元素进行计数。 例如， MultiByteToWideChar 采用以字节为单位计算的输入缓冲区，并将转换后的字符放入采用 Unicode 字符大小的缓冲区。 当应用程序使用此函数时，它必须正确调整缓冲区大小，以避免缓冲区溢出。<br><a href="https://docs.microsoft.com/zh-cn/windows/win32/intl/security-considerations--international-features" target="_blank" rel="noopener">关于Windows的字符转换函数</a></p><p><a href="https://docs.microsoft.com/en-us/windows/win32/intl/code-page-identifiers" target="_blank" rel="noopener">常用代码页</a></p><table><thead><tr><th></th><th>编码格式</th><th></th><th>代码页</th><th></th></tr></thead><tbody><tr><td>GB2312</td><td>936</td><td></td><td></td><td></td></tr><tr><td>BIG5</td><td>950</td><td></td><td></td><td></td></tr><tr><td>UTF-16/Unicode</td><td>1200</td><td></td><td></td><td></td></tr><tr><td>UTF-8</td><td>65001</td><td></td><td></td></tr></tbody></table><p>在Windows控制台，可以通过 chcp xxx 调整代码页（仅限当前窗口有效，若要永久修改，需要修改注册表）<br>例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REM 当前代码页修改为UTF8</span><br><span class="line">chcp 65001</span><br></pre></td></tr></table></figure><p><br></p><h2 id="Cocos2d-控制台"><a href="#Cocos2d-控制台" class="headerlink" title="Cocos2d 控制台"></a>Cocos2d 控制台</h2><p>控制台的开启与参数的调整，都是看Windows API的支持。</p><p>创建与释放</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AllocConsole();</span><br><span class="line">FreeConsole();</span><br></pre></td></tr></table></figure><p>控制台函数可参考： <a href="https://docs.microsoft.com/zh-cn/windows/console/console-functions" target="_blank" rel="noopener">Microsoft控制台函数</a></p><p>比如，关闭按钮禁止点击（这里面的枚举，自行查阅代码）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DeleteMenu(GetSystemMenu(GetConsoleWindow(), FALSE), SC_CLOSE, MF_BYCOMMAND);</span><br><span class="line">DrawMenuBar(GetConsoleWindow());</span><br></pre></td></tr></table></figure><p><br><br><br></p><h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><p>最终实际操作，就是将Cocos2d唤起的控制台中代码页调整为UTF8（65001）</p><p>在创建控制台后</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////////// main.cpp</span></span><br><span class="line"></span><br><span class="line">AllocConsole();</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">SetConsoleCP(<span class="number">65001</span>);</span><br><span class="line">SetConsoleOutputCP(<span class="number">65001</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>此时，代码页已被修改为 UTF8；但是，仅仅是输出的修改；在向控制台传输的部分也需要同步去调整，就是上文所说的关于 MultiByteToWideChar 与 WideCharToMultiByte 部分。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////////// CCConsole.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">MultiByteToWideChar(CP_UTF8, <span class="number">0</span>, tempBuf, <span class="number">-1</span>, wszBuf, <span class="keyword">sizeof</span>(wszBuf));</span><br><span class="line">OutputDebugStringW(wszBuf);</span><br><span class="line"><span class="comment">// // 将WideCharToMultiByte转换注释掉</span></span><br><span class="line"><span class="comment">// WideCharToMultiByte(CP_ACP, 0, wszBuf, -1, tempBuf, sizeof(tempBuf), nullptr, FALSE);</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s"</span>, tempBuf);</span><br></pre></td></tr></table></figure><p>问题：</p><ul><li>不支持泰文的显示<ul><li>发现通过代码页修改为65001，无法显示泰文</li><li>临时方案：可以通过输出到本地文件，获取内容</li></ul></li></ul><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Cocos2d 之 控制台&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="cocos2d" scheme="http://yoursite.com/tags/cocos2d/"/>
    
      <category term="想就做" scheme="http://yoursite.com/tags/%E6%83%B3%E5%B0%B1%E5%81%9A/"/>
    
  </entry>
  
  <entry>
    <title>小脚本之检测超规文件</title>
    <link href="http://yoursite.com/2021/10/29/%E5%B0%8F%E8%84%9A%E6%9C%AC%E4%B9%8B%E6%A3%80%E6%B5%8B%E8%B6%85%E8%A7%84%E6%96%87%E4%BB%B6/"/>
    <id>http://yoursite.com/2021/10/29/%E5%B0%8F%E8%84%9A%E6%9C%AC%E4%B9%8B%E6%A3%80%E6%B5%8B%E8%B6%85%E8%A7%84%E6%96%87%E4%BB%B6/</id>
    <published>2021-10-29T12:51:35.000Z</published>
    <updated>2021-10-30T14:43:51.386Z</updated>
    
    <content type="html"><![CDATA[<p>python脚本，检测不符合规则的文件。</p><a id="more"></a><p><br></p><h1 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h1><p>热更工作流的一个问题。<br>美术会交付策划未压缩的图片/视频，策划不检查直接提交，在审核更新资源的时候发现不合规资源，打回美术/策划压缩调整。</p><p>其他问题：</p><ul><li>检查不合规文件，需要开发遍历每条提交记录的文件，并判断是否合规；不同用途的文件是否合规的标准不同</li><li>现有环境下存在一些不合规的文件（之前开发疏忽，已更新到线上环境）</li></ul><p><br><br><br></p><h1 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h1><p>不合规文件特点：</p><ul><li>不同用途（文件夹下）的文件，规范不同</li><li>可以通用的根据大小来判断合规性</li><li>部分不合规的文件需要过滤掉（已经在线上了，不需要列出来）</li></ul><p>最终的设计思路：</p><ol><li>遍历所有文件，将超过阈值的文件全部列出</li><li>阈值可以动态调整<ul><li>所属文件夹</li><li>具体文件名</li><li>文件后缀</li></ul></li><li>可以设定缓存文件，若文件在缓存中，可以被过滤，不会列出</li></ol><p>代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   File: 检查文件大小</span></span><br><span class="line"><span class="comment">#   Version: v0.0.1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   </span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> join, getsize, isdir, splitext</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">##  一些配置项</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1KB = 1024</span></span><br><span class="line"><span class="comment"># 1MB = 1024 * 1024 = 1048576</span></span><br><span class="line"><span class="comment"># 5MB = 5 * 1024 * 1024</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认大小(byte, 1KB = 1024b)</span></span><br><span class="line">FILE_DEFAULT_SIZE = <span class="number">1048576</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 特殊大小限制（以文件夹为单位）</span></span><br><span class="line">SPECIAL_FOLDER_SIZE_MAP = &#123;</span><br><span class="line">    <span class="comment"># 'folder path(without \\ suffix)' : size,</span></span><br><span class="line">    <span class="string">'.\\Assets\\asset\\bg'</span> : <span class="number">2097152</span>,         <span class="comment">#2MB</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特殊大小限制（以文件为单位）</span></span><br><span class="line">SPECIAL_FILE_SIZE_MAP = &#123;</span><br><span class="line">    <span class="comment"># 'file path' : size,</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略的文件后缀</span></span><br><span class="line">IGNORE_FILE_SUFFIX_LIST = [</span><br><span class="line">    <span class="comment"># '.suffix',</span></span><br><span class="line">    <span class="string">'.exe'</span>,</span><br><span class="line">    <span class="string">'.dll'</span>,</span><br><span class="line">    <span class="string">'.animxml'</span>,</span><br><span class="line">    <span class="string">'.ttf'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 原始路径</span></span><br><span class="line">ORIGINAL_PATH = <span class="string">".\\Assets\\"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存文件</span></span><br><span class="line">STORAGE_FILE_PATH = <span class="string">".\\checkFileSizeTemp.json"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否生成缓存文件</span></span><br><span class="line">IS_GENERATE_STORAGE_FILE = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">needCheckFile</span><span class="params">(file_path, storage_map)</span>:</span></span><br><span class="line">    <span class="string">""" Check is file need to calculate size</span></span><br><span class="line"><span class="string">        1. is file suffix in IGNORE_FILE_SUFFIX_LIST</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        file_path: string</span></span><br><span class="line"><span class="string">            file path(include suffix)</span></span><br><span class="line"><span class="string">        storage_map: map&lt;file_path, file info&gt;</span></span><br><span class="line"><span class="string">            need be ignore file path</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        returns:</span></span><br><span class="line"><span class="string">            boolean: is file need be checked</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    file_cfg = splitext(file_path)</span><br><span class="line">    <span class="keyword">if</span> file_cfg[<span class="number">1</span>] <span class="keyword">in</span> IGNORE_FILE_SUFFIX_LIST:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> file_path <span class="keyword">in</span> storage_map.keys():</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDefaultSize</span><span class="params">(file_path, folder_path)</span>:</span></span><br><span class="line">    <span class="string">""" Get default standard size(byte)</span></span><br><span class="line"><span class="string">        1. get size by SPECIAL_FILE_SIZE_MAP and file path</span></span><br><span class="line"><span class="string">        2. get size by SPECIAL_FOLDER_SIZE_MAP and belong folder</span></span><br><span class="line"><span class="string">        3. get size by FILE_DEFAULT_SIZE direc</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        file_path: string</span></span><br><span class="line"><span class="string">            file path(include suffix)</span></span><br><span class="line"><span class="string">        folder_path: string</span></span><br><span class="line"><span class="string">            folder_path</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        returns:</span></span><br><span class="line"><span class="string">            int: file standrd size(byte)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    size = SPECIAL_FILE_SIZE_MAP.get(file_path)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> size:</span><br><span class="line">        size = SPECIAL_FOLDER_SIZE_MAP.get(folder_path, FILE_DEFAULT_SIZE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">notFileSizeStandard</span><span class="params">(file_path, folder_path)</span>:</span></span><br><span class="line">    <span class="string">""" Check is file size standard</span></span><br><span class="line"><span class="string">        compare file size and file standard size</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        file_path: string</span></span><br><span class="line"><span class="string">            file path(include suffix)</span></span><br><span class="line"><span class="string">        folder_path: string</span></span><br><span class="line"><span class="string">            folder_path</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        returns:</span></span><br><span class="line"><span class="string">            boolean: is file size not standard</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    default_size = getDefaultSize(file_path, folder_path)</span><br><span class="line">    file_size = getsize(file_path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(file_path + ' , ' + str(file_size) + ', ' + str(default_size) + '  ==  ' + str(file_size &gt;= default_size))</span></span><br><span class="line">    <span class="keyword">return</span> file_size &gt;= default_size, file_size, default_size</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">walkFolders</span><span class="params">(folder_path, storage_map)</span>:</span></span><br><span class="line">    <span class="string">""" Check is file size standard</span></span><br><span class="line"><span class="string">        compare file size and file standard size</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        folder_path: string</span></span><br><span class="line"><span class="string">            folder_path</span></span><br><span class="line"><span class="string">        storage_map: map&lt;file path, file info&gt;</span></span><br><span class="line"><span class="string">            need be ignore file path</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        returns:</span></span><br><span class="line"><span class="string">            dict[fileInfo]: illegal file info map</span></span><br><span class="line"><span class="string">                dict[fileInfo]</span></span><br><span class="line"><span class="string">                    path: file path</span></span><br><span class="line"><span class="string">                    size: file size</span></span><br><span class="line"><span class="string">                    standard: file standard size</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    illegal_file_map = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> file_path <span class="keyword">in</span> os.listdir(folder_path):</span><br><span class="line">        temp_path = join(folder_path, file_path)</span><br><span class="line">        <span class="keyword">if</span> isdir(temp_path):</span><br><span class="line">            temp_map = walkFolders(temp_path, storage_map)</span><br><span class="line">            illegal_file_map.update(temp_map)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> needCheckFile(temp_path, storage_map):</span><br><span class="line">                notStandard, file_size, standard_size = notFileSizeStandard(temp_path, folder_path)</span><br><span class="line">                <span class="keyword">if</span> notStandard:</span><br><span class="line">                    file_info = &#123;&#125;</span><br><span class="line">                    file_info[<span class="string">"path"</span>] = temp_path</span><br><span class="line">                    file_info[<span class="string">"size"</span>] = file_size</span><br><span class="line">                    file_info[<span class="string">"standard"</span>] = standard_size</span><br><span class="line"></span><br><span class="line">                    illegal_file_map[temp_path] = file_info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> illegal_file_map</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveStorageFileMap</span><span class="params">(illegal_file_map, storage_file_map)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> IS_GENERATE_STORAGE_FILE:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    storage_file_map.update(illegal_file_map)</span><br><span class="line">    <span class="keyword">with</span> codecs.open(STORAGE_FILE_PATH,<span class="string">'w'</span>, <span class="string">'utf-8'</span>) <span class="keyword">as</span> outf:</span><br><span class="line">        json.dump(storage_file_map, outf, ensure_ascii=<span class="keyword">False</span>)</span><br><span class="line">        outf.write(<span class="string">'\n'</span>)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadStorageFileMap</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(STORAGE_FILE_PATH):</span><br><span class="line">        print(<span class="string">"[WARNING] storage file not exist!"</span>)</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    file_map = &#123;&#125;</span><br><span class="line">    <span class="keyword">with</span> codecs.open(STORAGE_FILE_PATH, <span class="string">"r"</span>, <span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            temp = json.loads(line)</span><br><span class="line">            file_map.update(temp)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> file_map</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">regularOutputResult</span><span class="params">(illegal_file_map)</span>:</span></span><br><span class="line">    print(<span class="string">"\n\n-- Result: "</span>)</span><br><span class="line">    <span class="keyword">if</span> len(illegal_file_map) &lt;= <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"\n==========&gt; Success! &lt;==========\n\n"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"\n==========&gt; !Error! &lt;=========="</span>)</span><br><span class="line">        print(<span class="string">"==========&gt; !Error! &lt;=========="</span>)</span><br><span class="line">        print(<span class="string">"==========&gt; !Error! &lt;==========\n"</span>)</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> illegal_file_map.items():</span><br><span class="line">            size = v[<span class="string">'size'</span>] / <span class="number">1024</span></span><br><span class="line">            <span class="keyword">if</span> size / <span class="number">1024</span> &gt; <span class="number">0</span>:</span><br><span class="line">                print(<span class="string">'\t'</span> + k + <span class="string">'  |  '</span> + str(size / <span class="number">1024</span>) + <span class="string">'MB'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'\t'</span> + k + <span class="string">'  |  '</span> + str(size) + <span class="string">'KB'</span>)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"\n==========&gt; !Error! &lt;=========="</span>)</span><br><span class="line">        print(<span class="string">"==========&gt; !Error! &lt;=========="</span>)</span><br><span class="line">        print(<span class="string">"==========&gt; !Error! &lt;==========\n"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(dir)</span>:</span></span><br><span class="line">    print(<span class="string">"=================================================="</span>)</span><br><span class="line">    print(<span class="string">"Start"</span>)</span><br><span class="line">    print(<span class="string">"-- Config: "</span>)</span><br><span class="line">    print(<span class="string">"\tOri Path: "</span> + str(dir))</span><br><span class="line">    print(<span class="string">"\tStorage Path: "</span> + str(STORAGE_FILE_PATH))</span><br><span class="line">    print(<span class="string">"\tIs Generate Storage File: "</span> + str(IS_GENERATE_STORAGE_FILE))</span><br><span class="line"></span><br><span class="line">    storage_file_map = loadStorageFileMap()</span><br><span class="line">    <span class="comment"># print(json.dumps(storage_file_map, indent=4, ensure_ascii=False, encoding='utf-8'))</span></span><br><span class="line"></span><br><span class="line">    illegal_file_map = walkFolders(dir, storage_file_map)</span><br><span class="line">    regularOutputResult(illegal_file_map)</span><br><span class="line">    saveStorageFileMap(illegal_file_map, storage_file_map)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main(ORIGINAL_PATH)</span><br></pre></td></tr></table></figure></p><p>使用流程：<br>初次使用：</p><ol><li>找到一个稳定版本，执行缓存模式，缓存当前已在线上的不合规文件</li><li>动态配置一些阈值</li></ol><p>后续使用：</p><ol><li>在合并完资源后，执行脚本</li><li>若存在不合规文件，则列出具体路径，通知策划调整；若无不合规文件，显示Success。</li></ol><p><br><br><br></p><h1 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h1><p>依旧存在改进的方向。</p><p>按流程来说</p><ol><li>美术原图</li><li>策划修正</li><li>开发检查</li></ol><p>如果出现问题：</p><ol><li>美术原图</li><li>策划修正</li><li>开发检查，不合规，反馈策划</li><li>策划再次修正</li><li>开发检查，合规</li></ol><p>那么，既然我们开发检查的内容可以脚本化，即自动化；那完全可以前置检查，让策划无法提交不合规的文件。<br>这个就涉及到Hook，相关内容可参考文章 SVN之Hook</p><p><br><br><br><br><br><br><br><br><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;python脚本，检测不符合规则的文件。&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="想就做" scheme="http://yoursite.com/tags/%E6%83%B3%E5%B0%B1%E5%81%9A/"/>
    
  </entry>
  
  <entry>
    <title>字符集与字符编码</title>
    <link href="http://yoursite.com/2021/10/26/%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8E%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/"/>
    <id>http://yoursite.com/2021/10/26/%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8E%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/</id>
    <published>2021-10-26T14:35:16.000Z</published>
    <updated>2021-10-26T14:41:25.761Z</updated>
    
    <content type="html"><![CDATA[<p>全球化，多语言，Unicode，UTF8</p><a id="more"></a><p><br></p><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>在做游戏的全球化时，遇到的一个问题。</p><p>玩家名称可以混杂多国语言，但是要进行宽度检测。不同国家的字符宽度不同，比如中文、韩文、日文算2个宽度，其他算1个宽度。根据输入的多语言文本，准确计算宽度。</p><p>例如：</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">你好 - <span class="number">4</span></span><br><span class="line">สวัสดี - <span class="number">6</span></span><br><span class="line">こんにちは - <span class="number">10</span></span><br><span class="line">Привет - <span class="number">6</span></span><br><span class="line">안녕 - <span class="number">4</span></span><br><span class="line">Hello - <span class="number">5</span></span><br><span class="line">Olá - <span class="number">3</span></span><br><span class="line">你好สวัสดีこんにちはПривет안녕HelloOlá 宽度为 <span class="number">38</span></span><br></pre></td></tr></table></figure><p>这里泰文比较特殊一些，สวัสดี 在存储时会转为 สว◌ัสด◌ี，unicode中没有 วั 与 ดี 。</p><p><br></p><p><br></p><h1 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h1><h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><p>字符集即字符的集合。<br>字符是各种文字和符号的总称，包含各国文字、标点符号、图形符号、数字等。</p><p>常见的字符集</p><table><thead><tr><th>字符集名称</th><th>别称</th><th>特点</th><th>技术特征</th></tr></thead><tbody><tr><td>ASCII</td><td>American Standard Code for Information Interchange, 美国信息互换标准编码</td><td>主要用于显示现代英语和其他西欧语言，是最通用的单字节编码系统</td><td>7bits表示一个字符，共128个字符（0-127），其中32-126是可打印字符</td></tr><tr><td>Unicode</td><td>Universal Multiple-Octet Coded Character Set, 通用多八位编码字符集</td><td>支持现今世界各种不同语言的书面文本的交换、处理、显示；对每种语言中的每一个字符都设定了统一且唯一的二进制编码</td><td>使用十六进制数字，在书写时前面加上前缀 “U+”</td></tr><tr><td>UTF-8</td><td>8-bit Unicode Transformation Format, 将Unicode转成8bit格式 / 万国码</td><td>便于不同的计算机之间使用网络传输不同语言和编码文字，使得双字节的Unicode能在现存处理单字节系统上正确传输</td><td>UTF-8是一种针对Unicode的可变长字符编码；用1-6个字节编码Unicode字符，对应还有 UTF-16 与 UTF-32</td></tr><tr><td>GB2312</td><td>信息交换用汉字编码字符集·基本集</td><td>中国国家标准的简体中文字符集，于1981.5.1日实施</td><td>1. 区位码（分区表示）；对所收录的汉字进行分区处理，每区含有94个汉字/符号。 2. 双字节表示，即两个字节来编码一个字，高位字节与低位字节有各自范围</td></tr><tr><td>GB18030</td><td>信息交换用汉字编码字符集基本集的扩充</td><td>中国政府于2000年3月17日发布的汉字编码国家标准，2001年8月31日后在中国市场上发布的软件必须符合本标准；解决了汉字、日文假名、朝鲜语和中国少数民族文字组成的大字符集计算机编码问题。与 Unicode 3.0兼容，并且与 GB2312兼容</td><td>采用 单字节、双字节、四字节三种方式对字符编码。单字节部分使用 0x00-0x7F（与ASCII码对应）</td></tr><tr><td>BIG5</td><td>大五码/五大码</td><td>收录13053个中文字，在中国台湾使用广泛</td><td>双字节表示，即两个字节来编码一个字，高位字节与低位字节有各自范围</td></tr></tbody></table><p><br></p><h2 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h2><p>为什么需要编码？</p><ul><li>为了便于存储与传输，需要一个统一的规则来存取信息。（某段二进制代表什么信息）</li></ul><p>如何进行字符编码？</p><ul><li>编码转码所需元素：<ul><li>字库表，所有可读/可写的字符数据库</li><li>编码字符集，表示一个字符在字库表中的位置</li><li>字符编码，编码字符集与字库表的映射关系</li></ul></li><li>过程<ul><li>编码<ol><li>拿到一个字符准备存储</li><li>通过字符编码得到在编码字符集中值</li><li>将得到值存储</li></ol></li><li>转码<ul><li>得到要显示的值</li><li>通过字符编码得到对应字库中的值</li><li>将得到值进行显示</li></ul></li></ul></li><li>通过字符编码可以节省字库表大小</li></ul><p><br></p><h2 id="Unicode-amp-UTF-8"><a href="#Unicode-amp-UTF-8" class="headerlink" title="Unicode &amp; UTF-8"></a>Unicode &amp; UTF-8</h2><p>UTF-8编码为变长编码，最小编码单位（code unit）为一个字节，每个字节的前1-3个bit为描述性部分，后面的为实际序号部分。</p><ul><li>字节以 0 开头，当前字符为单字节字符，占用一个字节的空间；0之后的所有部分代表在Unicode中的序号。</li><li>字节以 10 开头，当前字符为多字节字符，当前字节为多字节字符的第二字节，10 后所有部分和第一字节的剩余部分共同组成在Unicode中的序号。</li><li>字节以 110 开头，当前字符为双字节字符，当前字节为双字节字符的第一字节，110 后所有部分与第二字节剩余部分共同组成在Unicode中的序号。（第二字节以10开头）</li><li>字节以 1110 开头，当前字符为三字节字符，当前字节为三字节字符的第一字节，1110 后所有部分与第二字节剩余部分第三字节剩余部分共同组成在Unicode中的序号。（第二字节与第三字节均以10开头）</li></ul><p>计划</p><table><thead><tr><th>字节</th><th>标准格式</th><th>容纳位数</th><th>16进制范围</th></tr></thead><tbody><tr><td>单字节</td><td>0xxx xxxx</td><td>0-7</td><td>0x0000 - 0x007F</td></tr><tr><td>双字节</td><td>110x xxxx 10xx xxxx</td><td>8-11</td><td>0x0080 - 0x07FF</td></tr><tr><td>三字节</td><td>1110 xxxx 10xx xxxx 10xx xxxx</td><td>12-16</td><td>0x0800 - 0xFFFF</td></tr></tbody></table><p>实际应用</p><table><thead><tr><th>实际字符</th><th>在Unicode字库中十六进制</th><th>在Unicode字库中二进制</th><th>UTF-8编码后的二进制</th><th>UTF-8编码后十六进制</th></tr></thead><tbody><tr><td>H</td><td>0048</td><td>100 1000</td><td>0100 1000</td><td>48</td></tr><tr><td>Ĉ</td><td>0108</td><td>1 0000 1000</td><td>1100 0100 1000 1000</td><td>C4 88</td></tr><tr><td>你</td><td>4F60</td><td>100 1111 0110 0000</td><td>1110 0100 1011 1101 1010 0000</td><td>E4 BD A0</td></tr></tbody></table><p><br></p><h2 id="Lua-amp-Unicode"><a href="#Lua-amp-Unicode" class="headerlink" title="Lua &amp; Unicode"></a>Lua &amp; Unicode</h2><p>Lua是否支持Unicode的呢？<br>在官网FAQ中，有一些讨论： <a href="http://lua-users.org/wiki/LuaUnicode" target="_blank" rel="noopener">Can I use unicode strings? or Does Lua support unicode?</a><br>主要意思就是Lua并不知道存储/处理的是否为Unicode，但Lua字符串是一个任意序列的字节序列，可以存储任意二进制的数据，包括Unicode；然后根据处理需求可自行扩展相应逻辑。</p><p>处理UTF-8的第三方文件：</p><ul><li><a href="https://github.com/starwing/luautf8" target="_blank" rel="noopener">UTF-8 module for Lua 5.x</a></li><li><a href="https://github.com/alexander-yakushev/awesompd/blob/master/utf8.lua" target="_blank" rel="noopener">awesompd/utf8.lua</a></li><li><a href="https://github.com/Stepets/utf8.lua" target="_blank" rel="noopener">Stepets/utf8.lua</a></li></ul><p><br></p><h1 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h1><p>按照需求，可定流程</p><ol><li>求出字符串的unicode值</li><li>查找unicode值区间，判断所属国家</li><li>根据国家来进行不同长度计算</li></ol><p>PS: 整个utf8相关方法，在文章最下方</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- http://www.unicode.org/charts/nameslist/</span></span><br><span class="line"><span class="keyword">local</span> UnicodeNationRangeList = &#123;</span><br><span class="line">    &#123;tip = <span class="string">"数字"</span>, range = &#123;&#123;<span class="number">0x30</span>, <span class="number">0x39</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;tip = <span class="string">"英文"</span>, range = &#123;&#123;<span class="number">0x41</span>, <span class="number">0x5A</span>&#125;, &#123;<span class="number">0x61</span>, <span class="number">0x7a</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;tip = <span class="string">"中文"</span>, range = &#123;&#123;<span class="number">0x2E80</span>, <span class="number">0x2FDF</span>&#125;, &#123;<span class="number">0x3400</span>, <span class="number">0x4dbf</span>&#125;, &#123;<span class="number">0x4E00</span>, <span class="number">0x9FFF</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;tip = <span class="string">"韩文"</span>, range = &#123;&#123;<span class="number">0x1100</span>, <span class="number">0x11FF</span>&#125;, &#123;<span class="number">0x3130</span>, <span class="number">0x318F</span>&#125;, &#123;<span class="number">0xAC00</span>, <span class="number">0xD7AF</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;tip = <span class="string">"日文"</span>, range = &#123;&#123;<span class="number">0x3040</span>, <span class="number">0x30FF</span>&#125;, &#123;<span class="number">0x31F0</span>, <span class="number">0x31FF</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;tip = <span class="string">"泰文"</span>, range = &#123;&#123;<span class="number">0x0E00</span>, <span class="number">0x0E7F</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;tip = <span class="string">"俄文"</span>, range = &#123;&#123;<span class="number">0x0400</span>, <span class="number">0x052F</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;tip = <span class="string">"法文/德文"</span>, range = &#123;&#123;<span class="number">0x00C0</span>, <span class="number">0x00FF</span>&#125;&#125;&#125;,</span><br><span class="line">    &#123;tip = <span class="string">"阿拉伯文"</span>, range = &#123;&#123;<span class="number">0x0600</span>, <span class="number">0x06FF</span>&#125;, &#123;<span class="number">0x0750</span>, <span class="number">0x077F</span>&#125;&#125;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">--[[DESC: 分析字符属于哪个国家文字</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    c: string</span></span><br><span class="line"><span class="comment">        字符</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    return: number, string</span></span><br><span class="line"><span class="comment">        number: 国家索引</span></span><br><span class="line"><span class="comment">        string: 国家简述</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Xutf8.analyseCharBelong</span><span class="params">(c)</span></span></span><br><span class="line">    <span class="keyword">local</span> nationIdx = <span class="number">-1</span></span><br><span class="line">    <span class="keyword">local</span> tip = <span class="string">"不识别"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> Xutf8.<span class="built_in">len</span>(c) ~= <span class="number">1</span> <span class="keyword">then</span> <span class="keyword">return</span> nationIdx, tip <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> hexStr, hexStrArr, hexValArr = Xutf8.utf8_to_unicode(c)</span><br><span class="line">    <span class="keyword">local</span> valueC = hexValArr[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, cfg <span class="keyword">in</span> <span class="built_in">ipairs</span>(UnicodeNationRangeList) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> rangeList = cfg.range</span><br><span class="line">        <span class="keyword">for</span> _, rangeCfg <span class="keyword">in</span> <span class="built_in">ipairs</span>(rangeList) <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> valueC &gt;= rangeCfg[<span class="number">1</span>] <span class="keyword">and</span> valueC &lt;= rangeCfg[<span class="number">2</span>] <span class="keyword">then</span></span><br><span class="line">                nationIdx = i</span><br><span class="line">                tip = cfg.tip</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> nationIdx ~= <span class="number">-1</span> <span class="keyword">then</span> <span class="keyword">break</span> <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nationIdx, tip</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[DESC: 返回字符串长度</span></span><br><span class="line"><span class="comment">        中文、日文、韩文，一个字符算两个长度</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        注意：有些会占据双字节，所以长度会有所偏差</span></span><br><span class="line"><span class="comment">            สวัสดี = สว◌ัสด◌ี  -- 长度为6</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    str: string</span></span><br><span class="line"><span class="comment">        字符串</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    return:</span></span><br><span class="line"><span class="comment">        int - 返回具体长度</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Xutf8.getSpecialLength</span><span class="params">(s)</span></span></span><br><span class="line">    <span class="keyword">local</span> l = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> realLen = Xutf8.<span class="built_in">len</span>(s)</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, realLen <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> c = Xutf8.<span class="built_in">sub</span>(s, i, i)</span><br><span class="line">        <span class="keyword">local</span> idx, tip = Xutf8.analyseCharBelong(c)</span><br><span class="line">        <span class="keyword">if</span> idx == <span class="number">3</span> <span class="keyword">or</span> idx == <span class="number">4</span> <span class="keyword">or</span> idx == <span class="number">5</span> <span class="keyword">then</span></span><br><span class="line">            l = l + <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            l = l + <span class="number">1</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><br></p><p><br></p><hr><p>参考文章:</p><ul><li><a href="https://www.cnblogs.com/yuanzhenliu/p/8494203.html" target="_blank" rel="noopener">各种语系的unicode对应以及local编码方式</a></li><li><a href="http://www.unicode.org/charts/nameslist/" target="_blank" rel="noopener">Unicode官网字符映射</a></li><li><a href="http://lua-users.org/wiki/LuaUnicode" target="_blank" rel="noopener">Lua是否支持Unicode</a></li><li><a href="http://cenalulu.github.io/linux/character-encoding/" target="_blank" rel="noopener">搞清字符集与字符编码</a></li><li><a href="https://www.ltool.net/characters-to-unicode-converter-in-simplified-chinese.php" target="_blank" rel="noopener">Unicode字符查询</a></li></ul><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全球化，多语言，Unicode，UTF8&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="想就做" scheme="http://yoursite.com/tags/%E6%83%B3%E5%B0%B1%E5%81%9A/"/>
    
  </entry>
  
</feed>
